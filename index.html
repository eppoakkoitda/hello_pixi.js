<!DOCTYPE html>
<html lang="ja">
<head>
   <meta charset="UTF-8" auther="eppo">
   <title>Start with pixi.js</title>
   <style>
     html{
       height: 100%
     }
     body{
       height: 100%;
       padding: 0;
       margin: 0;
     }
   </style>
</head>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/4.4.3/pixi.min.js"></script>
<script type="text/javascript">

    var Container = PIXI.Container,
    autoDetectRenderer = PIXI.autoDetectRenderer,
    loader = PIXI.loader,
    resources = PIXI.loader.resources,
    Sprite = PIXI.Sprite;

    var type = "WebGL";
    if(!PIXI.utils.isWebGLSupported()){
      type = "canvas"
    }
    PIXI.utils.sayHello(type);

    // 新しいレンダラー作る
    var stage = new Container(),
        renderer = autoDetectRenderer(256, 256);

    // それをHTMLファイルに入れる
    document.body.appendChild(renderer.view);

    loader
      .add(["img/kokkoro.json",
            "img/rino_3.png"
      ])
      .load(setup);

    var kokkoro,rino;

    function setup() {
      renderer.view.style.position = "absolute";
      renderer.view.style.display = "block";
      renderer.autoResize = true;
      renderer.resize(window.innerWidth, window.innerHeight);

      kokkoro = new Sprite(resources["img/kokkoro.json"].textures["test_0-0.png"]);
      rino = new Sprite(resources["img/rino_3.png"].texture);

      stage.addChild(kokkoro);
      stage.addChild(rino);

      kokkoro.position.set(50, 0);
      rino.position.set(0, 128);

      rino.vx = 0;
      rino.vy = 0;


      // // キーコード
      //  var left = keyboard(37),
      //      up = keyboard(38),
      //      right = keyboard(39),
      //      down = keyboard(40);
      //
      //  // 左
      //  left.press = function() {
      //
      //  };
      //  left.release = function() {
      //    if (!right.isDown && rino.vy === 0) {
      //      rino.vx = 0;
      //    }
      //  };
      //
      //  // 上
      //  up.press = function() {
      //
      //  };
      //  up.release = function() {
      //    if (!down.isDown && rino.vx === 0) {
      //      rino.vy = 0;
      //    }
      //  };
      //
      //  // 右
      //  right.press = function() {
      //
      //  };
      //  right.release = function() {
      //    if (!left.isDown && rino.vy === 0) {
      //      rino.vx = 0;
      //    }
      //  };
       //
       // // 下
       // down.press = function() {
       //
       // };
       // down.release = function() {
       //   if (!up.isDown && rino.vx === 0) {
       //     rino.vy = 0;
       //   }
       // };

      function onKeyDown(e) {
       // Display key information
       switch (e.code) {
         case 'ArrowLeft':
         case 'KeyA':
           rino.vx = -5;
           rino.vy = 0;
           break;
         case 'ArrowRight':
         case 'KeyD':
           rino.vx = 5;
           rino.vy = 0;
           break;
         case 'ArrowUp':
         case 'KeyW':
           rino.vy = -5;
           rino.vx = 0;
           break;
         case 'ArrowDown':
         case 'KeyS':
           rino.vy = 5;
           rino.vx = 0;
           break;
       }
       // Prevent the keyboard events from bubbling up to the broser itself
       e.preventDefault();
      };

      state = play;

      gameLoop();

    }

    function gameLoop(){

      requestAnimationFrame(gameLoop);
      state();

      renderer.render(stage);

    }

    function play(){
      rino.x += rino.vx;
      rino.y += rino.vy;
    }

    window.onresize = function () {
      renderer.resize(window.innerWidth, window.innerHeight);
    };

</script>
</body>
</html>
